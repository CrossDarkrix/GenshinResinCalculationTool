import base64, ui, locale, datetime, concurrent.futures, time
locale.normalize('ja_JP.UTF-8')
v = ui.load_view_str(base64.b64decode('WwogIHsKICAgICJub2RlcyIgOiBbCiAgICAgIHsKICAgICAgICAibm9kZXMiIDogWwoKICAgICAgICBdLAogICAgICAgICJmcmFtZSIgOiAie3syMCwgNTR9LCB7MjQ0LCA1NH19IiwKICAgICAgICAiY2xhc3MiIDogIkRhdGVQaWNrZXIiLAogICAgICAgICJhdHRyaWJ1dGVzIiA6IHsKICAgICAgICAgICJjbGFzcyIgOiAiRGF0ZVBpY2tlciIsCiAgICAgICAgICAiZnJhbWUiIDogInt7OTAsIDI5Mn0sIHszMjAsIDIxNn19IiwKICAgICAgICAgICJmbGV4IiA6ICIiLAogICAgICAgICAgIm5hbWUiIDogIlN0YXJ0UmVzaW5UaW1lIiwKICAgICAgICAgICJtb2RlIiA6IDIsCiAgICAgICAgICAidXVpZCIgOiAiNUQwOTkxM0UtMUNCOS00MzkxLUFFMDItNDRBQTY3OEQwMDA4IgogICAgICAgIH0sCiAgICAgICAgInNlbGVjdGVkIiA6IGZhbHNlCiAgICAgIH0sCiAgICAgIHsKICAgICAgICAibm9kZXMiIDogWwoKICAgICAgICBdLAogICAgICAgICJmcmFtZSIgOiAie3szOCwgMzQ3fSwgezI2NywgOTB9fSIsCiAgICAgICAgImNsYXNzIiA6ICJMYWJlbCIsCiAgICAgICAgImF0dHJpYnV0ZXMiIDogewogICAgICAgICAgImZsZXgiIDogIiIsCiAgICAgICAgICAibmFtZSIgOiAiUmVzdWx0IiwKICAgICAgICAgICJ0ZXh0X2NvbG9yIiA6ICJSR0JBKDAuMDU2NzM4LDAuMDU2NzM4LDAuMDU2NzM4LDEuMDAwMDAwKSIsCiAgICAgICAgICAiZnJhbWUiIDogInt7NzUsIDEzNH0sIHsxNTAsIDMyfX0iLAogICAgICAgICAgInV1aWQiIDogIjc5MjFCRTRBLTVENDMtNDRBMy1BQ0RDLUZGNjNCNkJBMjM1RCIsCiAgICAgICAgICAiY2xhc3MiIDogIkxhYmVsIiwKICAgICAgICAgICJhbGlnbm1lbnQiIDogImxlZnQiLAogICAgICAgICAgInRleHQiIDogIiIsCiAgICAgICAgICAiZm9udF9zaXplIiA6IDE1LAogICAgICAgICAgImZvbnRfbmFtZSIgOiAiPFN5c3RlbS1Cb2xkPiIKICAgICAgICB9LAogICAgICAgICJzZWxlY3RlZCIgOiBmYWxzZQogICAgICB9LAogICAgICB7CiAgICAgICAgIm5vZGVzIiA6IFsKCiAgICAgICAgXSwKICAgICAgICAiZnJhbWUiIDogInt7MjgsIDE3Nn0sIHsyNTAsIDY4fX0iLAogICAgICAgICJjbGFzcyIgOiAiQnV0dG9uIiwKICAgICAgICAiYXR0cmlidXRlcyIgOiB7CiAgICAgICAgICAiZmxleCIgOiAiIiwKICAgICAgICAgICJib3JkZXJfd2lkdGgiIDogMSwKICAgICAgICAgICJhY3Rpb24iIDogIiIsCiAgICAgICAgICAiZnJhbWUiIDogInt7MTEwLCAxMzR9LCB7ODAsIDMyfX0iLAogICAgICAgICAgInRpdGxlIiA6ICLmnJ015pmC44G+44Gn44Gr44Gn44GN44KL5r+D57iu5qi56ISC44KS6KiI566XIiwKICAgICAgICAgICJ1dWlkIiA6ICI2MTZERTU1NS02QzJFLTQwMjEtOUI5Qy04MTVCRDdEM0MwQ0YiLAogICAgICAgICAgImNsYXNzIiA6ICJCdXR0b24iLAogICAgICAgICAgImNvcm5lcl9yYWRpdXMiIDogMSwKICAgICAgICAgICJib3JkZXJfY29sb3IiIDogIlJHQkEoMC4wMDAwMDAsMC4wMDAwMDAsMC4wMDAwMDAsMS4wMDAwMDApIiwKICAgICAgICAgICJuYW1lIiA6ICJDYWxjIiwKICAgICAgICAgICJmb250X3NpemUiIDogMTUKICAgICAgICB9LAogICAgICAgICJzZWxlY3RlZCIgOiBmYWxzZQogICAgICB9LAogICAgICB7CiAgICAgICAgIm5vZGVzIiA6IFsKCiAgICAgICAgXSwKICAgICAgICAiZnJhbWUiIDogInt7MCwgNn0sIHszMTEsIDQwfX0iLAogICAgICAgICJjbGFzcyIgOiAiTGFiZWwiLAogICAgICAgICJhdHRyaWJ1dGVzIiA6IHsKICAgICAgICAgICJ1dWlkIiA6ICJGRDM4RUY3Mi1EMkY2LTRDRDAtQjkwNi1GRDM5QTJCQjk5MDIiLAogICAgICAgICAgImZvbnRfc2l6ZSIgOiAxOCwKICAgICAgICAgICJiYWNrZ3JvdW5kX2NvbG9yIiA6ICJSR0JBKDEuMDAwMDAwLDEuMDAwMDAwLDEuMDAwMDAwLDEuMDAwMDAwKSIsCiAgICAgICAgICAiZnJhbWUiIDogInt7NzUsIDE3OH0sIHsxNTAsIDMyfX0iLAogICAgICAgICAgInRpbnRfY29sb3IiIDogIlJHQkEoMC4wNTQzNzQsMC4wNTQzNzQsMC4wNTQzNzQsMS4wMDAwMDApIiwKICAgICAgICAgICJhbGlnbm1lbnQiIDogImNlbnRlciIsCiAgICAgICAgICAidGV4dF9jb2xvciIgOiAiUkdCQSgwLjAwMDAwMCwwLjAwMDAwMCwwLjAwMDAwMCwxLjAwMDAwMCkiLAogICAgICAgICAgInRleHQiIDogIiIsCiAgICAgICAgICAiZm9udF9uYW1lIiA6ICI8U3lzdGVtLUJvbGQ+IiwKICAgICAgICAgICJjbGFzcyIgOiAiTGFiZWwiLAogICAgICAgICAgIm5hbWUiIDogIk5vd1RpbWUiLAogICAgICAgICAgImZsZXgiIDogIiIKICAgICAgICB9LAogICAgICAgICJzZWxlY3RlZCIgOiBmYWxzZQogICAgICB9LAogICAgICB7CiAgICAgICAgIm5vZGVzIiA6IFsKCiAgICAgICAgXSwKICAgICAgICAiZnJhbWUiIDogInt7MzgsIDI2MH0sIHsyNjcsIDg3fX0iLAogICAgICAgICJjbGFzcyIgOiAiVGV4dFZpZXciLAogICAgICAgICJhdHRyaWJ1dGVzIiA6IHsKICAgICAgICAgICJ1dWlkIiA6ICJBQ0E1NjExQy0wRTY1LTRBMUQtOEZDMS0yMzQ5NEM0NEQ5RjAiLAogICAgICAgICAgImZvbnRfc2l6ZSIgOiAxNywKICAgICAgICAgICJmcmFtZSIgOiAie3s1NCwgMTMyfSwgezIwMCwgMjAwfX0iLAogICAgICAgICAgImVkaXRhYmxlIiA6IGZhbHNlLAogICAgICAgICAgImFsaWdubWVudCIgOiAibGVmdCIsCiAgICAgICAgICAiYXV0b2NvcnJlY3Rpb25fdHlwZSIgOiAiZGVmYXVsdCIsCiAgICAgICAgICAidGV4dF9jb2xvciIgOiAiUkdCQSgwLjAwMDAwMCwwLjAwMDAwMCwwLjAwMDAwMCwxLjAwMDAwMCkiLAogICAgICAgICAgImZvbnRfbmFtZSIgOiAiPFN5c3RlbT4iLAogICAgICAgICAgInNwZWxsY2hlY2tpbmdfdHlwZSIgOiAiZGVmYXVsdCIsCiAgICAgICAgICAiY2xhc3MiIDogIlRleHRWaWV3IiwKICAgICAgICAgICJuYW1lIiA6ICJHZXRSZXNpblRpbWUiLAogICAgICAgICAgImZsZXgiIDogIiIKICAgICAgICB9LAogICAgICAgICJzZWxlY3RlZCIgOiBmYWxzZQogICAgICB9LAogICAgICB7CiAgICAgICAgIm5vZGVzIiA6IFsKCiAgICAgICAgXSwKICAgICAgICAiZnJhbWUiIDogInt7MTcxLCAxMTZ9LCB7OTMsIDMyfX0iLAogICAgICAgICJjbGFzcyIgOiAiVGV4dEZpZWxkIiwKICAgICAgICAiYXR0cmlidXRlcyIgOiB7CiAgICAgICAgICAidXVpZCIgOiAiNjQ1NkYyMTMtNzE4RS00OTVELTkyRTItODVBMDM3NDI1QkFGIiwKICAgICAgICAgICJjb3JuZXJfcmFkaXVzIiA6IDEsCiAgICAgICAgICAiZnJhbWUiIDogInt7NTYsIDI4Mn0sIHsyMDAsIDMyfX0iLAogICAgICAgICAgImJvcmRlcl9jb2xvciIgOiAiUkdCQSgwLjM2NTI0OCwwLjM2NTI0OCwwLjM2NTI0OCwxLjAwMDAwMCkiLAogICAgICAgICAgImJvcmRlcl93aWR0aCIgOiAxLAogICAgICAgICAgImFsaWdubWVudCIgOiAiY2VudGVyIiwKICAgICAgICAgICJhdXRvY29ycmVjdGlvbl90eXBlIiA6ICJkZWZhdWx0IiwKICAgICAgICAgICJ0ZXh0X2NvbG9yIiA6ICJSR0JBKDAuMTM4Mjk4LDAuMTM4Mjk4LDAuMTM4Mjk4LDEuMDAwMDAwKSIsCiAgICAgICAgICAicGxhY2Vob2xkZXIiIDogIjAiLAogICAgICAgICAgImZvbnRfbmFtZSIgOiAiPFN5c3RlbT4iLAogICAgICAgICAgInNwZWxsY2hlY2tpbmdfdHlwZSIgOiAiZGVmYXVsdCIsCiAgICAgICAgICAiY2xhc3MiIDogIlRleHRGaWVsZCIsCiAgICAgICAgICAibmFtZSIgOiAibm93UmVzaW4iLAogICAgICAgICAgImZvbnRfc2l6ZSIgOiAxNwogICAgICAgIH0sCiAgICAgICAgInNlbGVjdGVkIiA6IGZhbHNlCiAgICAgIH0sCiAgICAgIHsKICAgICAgICAibm9kZXMiIDogWwoKICAgICAgICBdLAogICAgICAgICJmcmFtZSIgOiAie3syOCwgMTE2fSwgezE0MywgMzJ9fSIsCiAgICAgICAgImNsYXNzIiA6ICJMYWJlbCIsCiAgICAgICAgImF0dHJpYnV0ZXMiIDogewogICAgICAgICAgImZvbnRfc2l6ZSIgOiAxOCwKICAgICAgICAgICJmcmFtZSIgOiAie3s4MSwgMjgyfSwgezE1MCwgMzJ9fSIsCiAgICAgICAgICAidXVpZCIgOiAiMkEwRTgwMTQtRDVGMS00ODZCLUE0QkQtMkY1RjJCMDYwRUMxIiwKICAgICAgICAgICJjbGFzcyIgOiAiTGFiZWwiLAogICAgICAgICAgImFsaWdubWVudCIgOiAibGVmdCIsCiAgICAgICAgICAidGV4dCIgOiAi5pei44Gr44GC44KL5qi56ISC5pWwOiIsCiAgICAgICAgICAibmFtZSIgOiAiIiwKICAgICAgICAgICJmb250X25hbWUiIDogIjxTeXN0ZW0+IgogICAgICAgIH0sCiAgICAgICAgInNlbGVjdGVkIiA6IGZhbHNlCiAgICAgIH0KICAgIF0sCiAgICAiZnJhbWUiIDogInt7MCwgMH0sIHszMTEsIDU5NX19IiwKICAgICJjbGFzcyIgOiAiVmlldyIsCiAgICAiYXR0cmlidXRlcyIgOiB7CiAgICAgICJib3JkZXJfY29sb3IiIDogIlJHQkEoMC4wMDAwMDAsMC4wMDAwMDAsMC4wMDAwMDAsMS4wMDAwMDApIiwKICAgICAgImVuYWJsZWQiIDogdHJ1ZSwKICAgICAgImJhY2tncm91bmRfY29sb3IiIDogIlJHQkEoMS4wMDAwMDAsMS4wMDAwMDAsMS4wMDAwMDAsMS4wMDAwMDApIiwKICAgICAgIm5hbWUiIDogIlJlc2luQ2FsY3VsYXRpb25Ub29sIiwKICAgICAgInRpbnRfY29sb3IiIDogIlJHQkEoMC4wMDAwMDAsMC40NzgwMDAsMS4wMDAwMDAsMS4wMDAwMDApIiwKICAgICAgImZsZXgiIDogIiIKICAgIH0sCiAgICAic2VsZWN0ZWQiIDogZmFsc2UKICB9Cl0='))


def RealtimeRefresh():
	r = [0]
	for _i in r:
		v['NowTime'].text = '現在時刻: {}'.format(dt.now().strftime('%Y/%m/%d %H:%M:%S'))
		time.sleep(0.98)
		r.append(_i+1)

def calcTime():
	v['nowResin'].end_editing()
	if v['nowResin'].text == '':
		nowResin = 0
		v['nowResin'].text = '0'
	else:
		nowResin = int(v['nowResin'].text)
	Time = [v['StartResinTime'].date]
	resin_time_count = []
	LoopTime = [0]
	for _i in LoopTime:
		if not Time[0].day == v['StartResinTime'].date.day:
			break
		elif 5 <= Time[0].hour and v['StartResinTime'].date.day == Time[0].day:
			if not nowResin == 0:
				Time[0] = (Time[0] + datetime.timedelta(minutes=int((40 - nowResin) * 8 - 1)))
				nowResin = 0
			else:
				Time[0] = (Time[0] + datetime.timedelta(minutes=5*60))
			resin_time_count.append('推定時刻: {}'.format(Time[0].strftime('%Y/%m/%d %H:%M:%S')))
		else:
			break
		LoopTime.append(_i+1)
	v['Result'].text = '今から数えて濃縮樹脂が作れる回数: {}'.format(len(resin_time_count))
	v['GetResinTime'].text = '\n'.join(resin_time_count)

def main(v):
	concurrent.futures.ThreadPoolExecutor().submit(calcTime)
concurrent.futures.ThreadPoolExecutor().submit(RealtimeRefresh)
v['Calc'].action = main
v.present('popover', orientations=['portrait'])
